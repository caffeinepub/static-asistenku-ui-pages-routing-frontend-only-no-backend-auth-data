{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Enable Internet Identity login + manual workspace and registration flows for external Client/Partner pages",
  "requirements": [
    {
      "id": "REQ-177",
      "summary": "Create/update only the 4 specified external page files (no other edits, no new routes) and default-export a React component from each.",
      "acceptanceCriteria": [
        "No files other than the 4 specified `frontend/src/pages/external/*` files are modified.",
        "Each of the 4 files exists and default-exports a React component.",
        "No new routes are added anywhere (no edits to routing files)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "create",
          "description": "Create external Client login page at this exact path with a default-exported React component, keeping PageShell-based layout consistent with existing public login pages."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "create",
          "description": "Create external Partner login page at this exact path with a default-exported React component, keeping PageShell-based layout consistent with existing public login pages."
        },
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "create",
          "description": "Create external Client register page at this exact path with a default-exported React component, keeping PageShell-based layout consistent with existing public register pages."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "create",
          "description": "Create external Partner register page at this exact path with a default-exported React component, keeping PageShell-based layout consistent with existing public register pages."
        }
      ]
    },
    {
      "id": "REQ-178",
      "summary": "Implement Internet Identity login state and click-triggered login behavior in external Client/Partner login pages using useInternetIdentity() and useActor().",
      "acceptanceCriteria": [
        "Both login pages render an enabled “Login Internet Identity” button (not labeled as disabled).",
        "Clicking the II login button calls `login()` only from a user click handler, not from `useEffect`/onLoad.",
        "`actor.getCallerUser()` is never called automatically on initial render/mount."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Implement required local state (`isLoggedInII`, `isLoadingII`, `isLoadingWorkspace`, `error`) and wire an enabled “Login Internet Identity” button to call `useInternetIdentity().login()` only from an onClick handler; on success set `isLoggedInII=true`; do not call `actor.getCallerUser()` on mount."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Implement required local state (`isLoggedInII`, `isLoadingII`, `isLoadingWorkspace`, `error`) and wire an enabled “Login Internet Identity” button to call `useInternetIdentity().login()` only from an onClick handler; on success set `isLoggedInII=true`; do not call `actor.getCallerUser()` on mount."
        }
      ]
    },
    {
      "id": "REQ-179",
      "summary": "Implement manual Workspace button flow on external Client/Partner login pages with registration checks, role mismatch handling, and dashboard navigation.",
      "acceptanceCriteria": [
        "Before II login succeeds, the Workspace button is disabled.",
        "After II login succeeds, the Workspace button becomes enabled.",
        "Clicking Workspace calls `actor.getCallerUser()` exactly once per click (no retries unless user clicks again).",
        "If backend indicates the caller is unregistered, the page navigates to the appropriate existing register page for that role.",
        "If backend indicates role mismatch, the page shows the exact mismatch string `Silahkan klik sesuai dengan akun anda` and provides a back button that navigates to the role’s login page.",
        "If backend indicates role match and acceptable status, the page navigates to the existing role dashboard route.",
        "No redirects occur automatically in `useEffect`/onLoad; navigation happens only from explicit button clicks."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Add “Masuk ke ruang kerja” button that is disabled when `!isLoggedInII`; on click, guard double-submit, set `isLoadingWorkspace=true`, clear `error`, call `actor.getCallerUser()` exactly once, then: if null/unregistered navigate (manual button-triggered) to existing Client register path (use project’s existing `/client/register`); if role mismatch show public error `Silahkan klik sesuai dengan akun anda` with a back button navigating to existing Client login path (`/client/login`); if role matches navigate to existing Client dashboard path (`/client/dashboard`); always reset `isLoadingWorkspace=false` in `finally`."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Add “Masuk ke ruang kerja” button that is disabled when `!isLoggedInII`; on click, guard double-submit, set `isLoadingWorkspace=true`, clear `error`, call `actor.getCallerUser()` exactly once, then: if null/unregistered navigate (manual button-triggered) to existing Partner register path (use project’s existing `/partner/register`); if role mismatch show public error `Silahkan klik sesuai dengan akun anda` with a back button navigating to existing Partner login path (`/partner/login`); if role matches navigate to existing Partner dashboard path (`/partner/dashboard`); always reset `isLoadingWorkspace=false` in `finally`."
        }
      ]
    },
    {
      "id": "REQ-180",
      "summary": "Implement external Client/Partner registration pages with II gating, controlled form state, and no auto-redirect on mount.",
      "acceptanceCriteria": [
        "Both register pages show an enabled “Login Internet Identity” button above the Register/Daftar button when not logged in.",
        "The registration form’s submit action is not triggered automatically (no onLoad submission and no auto-redirect).",
        "The component maintains local controlled state for each required input field."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Implement controlled inputs for `nama`, `email`, `whatsapp`, `perusahaan` plus `isSubmitting`, `isLoggedInII`, `success`, `error`; add an enabled “Login Internet Identity” button above “Daftar” when `!isLoggedInII` that calls `useInternetIdentity().login()` on click and sets `isLoggedInII=true` on success; do not auto-redirect on mount."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Implement controlled inputs for `nama`, `email`, `whatsapp`, `keahlian`, `domisili` plus `isSubmitting`, `isLoggedInII`, `success`, `error`; add an enabled “Login Internet Identity” button above “Daftar” when `!isLoggedInII` that calls `useInternetIdentity().login()` on click and sets `isLoggedInII=true` on success; do not auto-redirect on mount."
        }
      ]
    },
    {
      "id": "REQ-181",
      "summary": "Add validation and enablement rules for the “Daftar” button on external registration pages.",
      "acceptanceCriteria": [
        "When not logged in with II, the “Daftar” button is disabled.",
        "When logged in with II and all required fields are valid, the “Daftar” button becomes enabled.",
        "If any required field becomes invalid/empty again, the “Daftar” button becomes disabled again."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Compute minimal validation (nama>=2 chars, email contains '@', whatsapp >=9 digits, perusahaan non-empty) and disable “Daftar” when `!isLoggedInII` or invalid fields or `isSubmitting`."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Compute minimal validation (nama>=2 chars, email contains '@', whatsapp >=9 digits, keahlian non-empty, domisili non-empty) and disable “Daftar” when `!isLoggedInII` or invalid fields or `isSubmitting`."
        }
      ]
    },
    {
      "id": "REQ-182",
      "summary": "Implement external Client registration submit handler calling the existing backend client registration method, with success state and safe error handling.",
      "acceptanceCriteria": [
        "Client registration calls a backend method for client registration exactly from the submit button click handler.",
        "If the call succeeds, the page switches to a success state without any automatic redirect.",
        "If the call fails, an error banner is shown and the page does not crash.",
        "No new backend code or endpoints are introduced."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "On “Daftar” click, guard double-submit, set `isSubmitting=true`, clear `error`, then call the existing actor client registration method using current typings (expected `actor.registerClient(profile)` with `{ name: nama, email, whatsapp, company: perusahaan }`); on success set `success=true` without auto-navigation; on failure catch and show a non-crashing error banner message; reset `isSubmitting` in `finally`."
        }
      ]
    },
    {
      "id": "REQ-183",
      "summary": "Implement external Partner registration submit handler calling the existing backend partner registration method, with success state and safe error handling.",
      "acceptanceCriteria": [
        "Partner registration calls a backend method for partner registration exactly from the submit button click handler.",
        "If the call succeeds, the page switches to a success state without any automatic redirect.",
        "If the call fails, an error banner is shown and the page does not crash.",
        "No new backend code or endpoints are introduced."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "On “Daftar” click, guard double-submit, set `isSubmitting=true`, clear `error`, then call the existing actor partner registration method using current typings (expected `actor.registerPartner(profile)` with `{ name: nama, email, whatsapp, keahlian, domisili }`); on success set `success=true` without auto-navigation; on failure catch and show a non-crashing error banner message; reset `isSubmitting` in `finally`."
        }
      ]
    },
    {
      "id": "REQ-184",
      "summary": "Show success-state UI after registration on both register pages, with manual “Masuk ke ruang kerja” navigation that calls getCallerUser once and goes to the existing dashboard.",
      "acceptanceCriteria": [
        "After a successful registration, the form inputs are no longer shown and a success view is shown instead.",
        "The success view shows the exact message `Pendaftaran berhasil`.",
        "Clicking “Masuk ke ruang kerja” in the success view calls `actor.getCallerUser()` exactly once and then navigates to the existing role dashboard route.",
        "No `useEffect`/onLoad redirect occurs after success."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "When `success===true`, replace the form with a success view showing exact text `Pendaftaran berhasil` and a “Masuk ke ruang kerja” button that, on click only, calls `actor.getCallerUser()` exactly once and navigates to existing Client dashboard path (`/client/dashboard`); no automatic redirect."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "When `success===true`, replace the form with a success view showing exact text `Pendaftaran berhasil` and a “Masuk ke ruang kerja” button that, on click only, calls `actor.getCallerUser()` exactly once and navigates to existing Partner dashboard path (`/partner/dashboard`); no automatic redirect."
        }
      ]
    },
    {
      "id": "REQ-185",
      "summary": "Add anti-double-submit protections across all 4 external pages by disabling action buttons during loading and guarding handlers.",
      "acceptanceCriteria": [
        "Repeated clicks while loading do not trigger duplicate backend calls.",
        "Buttons visually and functionally disable while loading/submitting.",
        "Loading state always resets even when backend calls throw errors (no stuck loading state)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Ensure II login and Workspace buttons are disabled while `isLoadingII`/`isLoadingWorkspace` are true, and handlers early-return when the corresponding flag is already true; clear `error` on new attempts; use `finally` to reset loading flags."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Ensure II login and Workspace buttons are disabled while `isLoadingII`/`isLoadingWorkspace` are true, and handlers early-return when the corresponding flag is already true; clear `error` on new attempts; use `finally` to reset loading flags."
        },
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Ensure II login, “Daftar”, and success “Masuk ke ruang kerja” buttons disable appropriately during `isLoadingII`/`isSubmitting`/workspace-loading state and handlers early-return when already loading; clear `error` on new attempts; use `finally` resets."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Ensure II login, “Daftar”, and success “Masuk ke ruang kerja” buttons disable appropriately during `isLoadingII`/`isSubmitting`/workspace-loading state and handlers early-return when already loading; clear `error` on new attempts; use `finally` resets."
        }
      ]
    },
    {
      "id": "REQ-186",
      "summary": "Keep existing PageShell-based layout and styling; add minimal UI for loading/disabled states, error banner, and success state.",
      "acceptanceCriteria": [
        "Pages still look and feel consistent with the existing public pages (no major visual redesign).",
        "An error banner/alert area appears only when an error exists and does not break layout.",
        "Login buttons are enabled/disabled exactly per the required state rules."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Match existing public login UI structure (PageShell wrapper, card spacing, button styles) and add only minimal UI: enabled/disabled states, optional loading labels, and an error banner region rendered when `error` is non-null."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Match existing public login UI structure (PageShell wrapper, card spacing, button styles) and add only minimal UI: enabled/disabled states, optional loading labels, and an error banner region rendered when `error` is non-null."
        },
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Match existing public register UI structure (PageShell wrapper, form spacing, button styles) and add only minimal UI: enabled “Login Internet Identity” gating button, disabled/enabled “Daftar”, error banner when `error` is non-null, and success-state replacement."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Match existing public register UI structure (PageShell wrapper, form spacing, button styles) and add only minimal UI: enabled “Login Internet Identity” gating button, disabled/enabled “Daftar”, error banner when `error` is non-null, and success-state replacement."
        }
      ]
    },
    {
      "id": "REQ-187",
      "summary": "Ensure all navigation is manual via explicit button clicks only (no useEffect/onLoad/state-change redirects) in all 4 external pages.",
      "acceptanceCriteria": [
        "There are no automatic redirects triggered by `useEffect`/onLoad in any of the 4 files.",
        "After II login succeeds, the user remains on the current page until they click Workspace (or another explicit navigation button/link)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Implement navigation only inside click handlers (e.g., using the project’s existing history pushState + PopStateEvent pattern or `window.location.href`); do not navigate in `useEffect` and do not auto-navigate when `isLoggedInII` becomes true."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Implement navigation only inside click handlers (e.g., using the project’s existing history pushState + PopStateEvent pattern or `window.location.href`); do not navigate in `useEffect` and do not auto-navigate when `isLoggedInII` becomes true."
        },
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Ensure there is no auto-redirect after II login or after `success` becomes true; navigation to dashboard occurs only when the user clicks the provided “Masuk ke ruang kerja” button."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Ensure there is no auto-redirect after II login or after `success` becomes true; navigation to dashboard occurs only when the user clicks the provided “Masuk ke ruang kerja” button."
        }
      ]
    },
    {
      "id": "REQ-188",
      "summary": "Ensure TypeScript compile/runtime stability with defensive handling for actor availability, backend failures, and unexpected getCallerUser shapes.",
      "acceptanceCriteria": [
        "No runtime crash occurs when actor is null or still fetching; UI shows a calm error state instead of crashing when actions are attempted too early.",
        "Backend exceptions are caught and surfaced in the error banner (no unhandled promise rejections).",
        "TypeScript build passes."
      ],
      "file_operations": [
        {
          "path": "frontend/src/pages/external/ClientLogin.tsx",
          "operation": "modify",
          "description": "Handle `actor` null / `useActor().isFetching` by preventing actions and showing a safe error banner when user attempts actions too early; defensively parse `getCallerUser()` return (check for `__kind__` before role compare); catch exceptions and surface safe messages; keep TypeScript types sound (use narrowings or `unknown` parsing as needed)."
        },
        {
          "path": "frontend/src/pages/external/PartnerLogin.tsx",
          "operation": "modify",
          "description": "Handle `actor` null / `useActor().isFetching` by preventing actions and showing a safe error banner when user attempts actions too early; defensively parse `getCallerUser()` return (check for `__kind__` before role compare); catch exceptions and surface safe messages; keep TypeScript types sound (use narrowings or `unknown` parsing as needed)."
        },
        {
          "path": "frontend/src/pages/external/ClientRegister.tsx",
          "operation": "modify",
          "description": "Handle `actor` null / `useActor().isFetching` by disabling registration/workspace actions until ready and showing safe error on attempts; catch backend errors for register/workspace flows; avoid assumptions about backend return shapes; ensure no uncontrolled input warnings by using controlled state for all fields."
        },
        {
          "path": "frontend/src/pages/external/PartnerRegister.tsx",
          "operation": "modify",
          "description": "Handle `actor` null / `useActor().isFetching` by disabling registration/workspace actions until ready and showing safe error on attempts; catch backend errors for register/workspace flows; avoid assumptions about backend return shapes; ensure no uncontrolled input warnings by using controlled state for all fields."
        }
      ]
    }
  ]
}