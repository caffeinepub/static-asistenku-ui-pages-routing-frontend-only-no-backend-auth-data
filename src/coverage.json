{
  "kind": "coverage_report",
  "version": "1.0",
  "generatedAt": "2026-02-17T14:59:08.202Z",
  "sources": {
    "buildRequest": true,
    "implementationPlan": true
  },
  "requirements": {
    "total": 7,
    "implemented": 0,
    "items": [
      {
        "id": "REQ-200",
        "summary": "Modify ONLY `backend/main.mo` to implement the new “Layanan V4” system strictly as an append-only change: add all new code at the very end of the actor (immediately before the final closing brace `}`) without modifying, deleting, moving, reformatting, or reorganizing any existing lines. Do not create any new files.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-201",
        "summary": "In the appended block, define the Layanan V4 types exactly as specified: `public type LayananTypeV4 = { #TENANG; #RAPI; #FOKUS; #JAGA; #EFEKTIF };` and `public type LayananV4 = { id: Text; clientPrincipal: Principal; tipe: LayananTypeV4; unitTotal: Nat; unitUsed: Nat; hargaPerUnit: Nat; asistenmuPrincipal: Principal; sharedWith: [Principal]; isActive: Bool; isArchived: Bool; createdAt: Int; createdBy: Principal; updatedAt: Int; updatedBy: Principal; };`.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-202",
        "summary": "In the appended block, add new stable storage dedicated to V4 only (unique names; do not collide with existing vars): `stable var layananV4Counter : Nat = 0;`, `stable var layananV4Store : [(Text, LayananV4)] = [];`, and `stable var layananV4IndexByClient : [(Principal, [Text])] = [];`. Also add runtime `HashMap`/`Map` structures for fast access: (1) `layananV4ById` keyed by `Text` and (2) `layananV4IdsByClient` keyed by `Principal` to `[Text]`. Keep the stable and runtime stores consistent on every mutation.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-203",
        "summary": "In the appended block, implement LV4 id generation using the exact format `LV4-<Nat>` (e.g., `LV4-1`, `LV4-2`, …) based on `layananV4Counter` and ensure it increments monotonically.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-204",
        "summary": "In the appended block, add a new internal-only authorization helper that allows only callers whose existing role is one of: `superadmin`, `admin`, or `finance`. If not allowed, it must trap with the exact message `\"Unauthorized\"`. This helper must reuse the existing role system already present in `backend/main.mo` and must not modify any existing access control logic.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-205",
        "summary": "In the appended block, implement the following public internal-only Layanan V4 methods with the exact names/parameters/behaviors specified, without changing any existing V1/V2/V3 layanan methods or other domains:\n1) `createLayananV4(input)` creates a new record: required input fields: `clientPrincipal`, `tipe`, `unitTotal`, `hargaPerUnit`, `asistenmuPrincipal`, `sharedWith` (may be empty), `isActive` (default `true` if not provided). It must set `unitUsed=0`, `isArchived=false`, set created/updated timestamps and principals to the caller, persist to store + index-by-client, and return the created `LayananV4`.\n2) `editLayananV4(layananId, patch)` allows editing ONLY: `clientPrincipal` (update index if changed), `tipe`, `unitTotal` (validate `unitTotal >= unitUsed`), `hargaPerUnit`, `asistenmuPrincipal`, `sharedWith`, `isActive`. It must NOT allow editing: `id`, `unitUsed`, `isArchived`, `createdAt`, `createdBy`. If layanan not found OR already archived, trap exactly `\"Not found\"`. If `unitTotal < unitUsed`, trap exactly `\"unitTotal cannot be less than unitUsed\"`. Must set `updatedAt/updatedBy` and return the updated `LayananV4`.\n3) `setLayananV4Active(layananId, isActive)` rejects if archived, updates `updatedAt/updatedBy`, returns updated `LayananV4`.\n4) `archiveLayananV4(layananId)` sets `isArchived=true`, `isActive=false`, updates `updatedAt/updatedBy`, returns updated `LayananV4`.\n5) `listAllLayananV4(includeArchived : Bool)` returns all V4 records, filtered by `isArchived` according to the flag.\n6) `listLayananV4ByClient(clientPrincipal, includeArchived : Bool)` returns V4 records for a specific client principal, filtered by `isArchived` according to the flag.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      },
      {
        "id": "REQ-206",
        "summary": "Perform a backend compile sanity pass after implementing Layanan V4 to ensure `backend/main.mo` compiles successfully and that no existing public methods (registration, claimSuperadmin, master data, status/partner-level utilities, etc.) have changed behavior due to the append-only patch.",
        "status": "unknown",
        "plannedFiles": [],
        "matchedFiles": []
      }
    ]
  },
  "changedFiles": [
    "backend/main.mo",
    "build-request.json",
    "feature_evidence.json",
    "frontend-file-summaries.txt",
    "frontend-implementation-plan.json",
    "frontend/src/backend.d.ts",
    "frontend/src/backend.ts",
    "frontend/src/declarations/backend.did.d.ts",
    "frontend/src/declarations/backend.did.js",
    "frontend/src/hooks/useQueries.ts",
    "frontend/src/pages/dashboards/SuperadminDashboard.tsx",
    "frontend/src/pages/external/ClientLogin.tsx",
    "frontend/src/pages/external/ClientRegister.tsx",
    "frontend/src/pages/external/PartnerLogin.tsx",
    "frontend/src/pages/external/PartnerRegister.tsx",
    "project_state.json",
    "scratch/component-selection.json",
    "spec.md",
    "spec_vs_diff_report.json"
  ]
}