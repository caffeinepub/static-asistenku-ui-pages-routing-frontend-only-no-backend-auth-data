{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 41,
  "summary": "Scope now includes a frontend change: InternalLogin.tsx is the only page allowed to call backend and run a full Internal Login flow (II login, getCallerUser, isSuperadminClaimed, claimSuperadmin, role validation, warnings, and dashboard redirects). All other pages remain static UI-only with no backend calls. Backend persistence work remains focused on upgrade-safe state (stable vars/snapshots) in backend/main.mo.",
  "architectural_notes": [
    "All pages are static UI only: no Internet Identity, no backend calls, no mock data, no role/user logic, no auto-redirects; navigation only via clicks.",
    "Use react-router-dom Routes with explicit mappings and a '*' fallback 404 page with a button back to '/'",
    "Global UI style: white background, centered container maxWidth 760 with generous padding, centered logo asistenku-horizontal.png, main card rounded 24px with subtle shadow and ample whitespace; no sidebar/navbar template.",
    "Ensure App.tsx uses BrowserRouter + Routes from react-router-dom and does not crash on load.",
    "All specified page files must default-export a React component; all import paths must be valid (no missing files).",
    "Do not use any external UI libraries; use plain divs + simple className only.",
    "Do not use any images besides asistenku-horizontal.png; write img src exactly \"asistenku-horizontal.png\" (no folder prefix).",
    "Add sufficient top padding so the logo is not covered; ensure no TS/React compile errors and no blank page—route \"/\" must render normally.",
    "Backend is now in-scope: backend/main.mo may be fully implemented per the backend spec (no longer required to be empty/untouched).",
    "For the current backend build request, ONLY modify backend/main.mo; do not change any frontend files."
  ],
  "known_issues": [
    "Unintended frontend changes were made previously; must be reverted so frontend has zero diff for this request.",
    "Previous automated patch/build attempt failed to apply the requested backend/main.mo change (tool error).",
    "saveCallerUserProfile currently overwrites userRoles (can overwrite role) causing repeated/incorrect role state; must be disabled via trap.",
    "Build/apply attempts for large backend persistence patch and subsequent InternalLogin patch repeatedly failed due to tooling limitations ('AI struggled/couldn't process request').",
    "Superadmin claim is currently failing because InternalLogin.tsx appears to be calling the wrong backend method (e.g., saveCallerUserProfile/role assignment) leading to \"Unauthorized: Only admins can assign user roles\" instead of calling claimSuperadmin()."
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-do-not-create-edit-or-reference-any-backend-code-keep-backend-main-mo-completely-untouched-and-keep-the-backend-100-empty-no-methods-data-structures",
      "title": "Do not create, edit, or reference any backend code. Keep backend/main.mo completely untouched and keep the backend 100% empty (no methods, data, structures).",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-only-edit-create-the-following-frontend-files-and-no-others-frontend-src-app-tsx-and-the-page-files-listed-by-the-user-under-frontend-src-pages-do-not-edit-any-other-files",
      "title": "Only edit/create the following frontend files (and no others): frontend/src/App.tsx and the page files listed by the user under frontend/src/pages/**. Do not edit any other files.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-react-router-routes-in-frontend-src-app-tsx-exactly-per-the-mapping-provided-including-a-fallback-that-shows-a-simple-inline-404-view-with-a-button-labeled-kembali-ke-landing-linking-to-do-not-add-any-automatic-redirects",
      "title": "Implement React Router routes in frontend/src/App.tsx exactly per the mapping provided, including a \"*\" fallback that shows a simple inline 404 view with a button labeled \"Kembali ke Landing\" linking to \"/\". Do not add any automatic redirects.",
      "reqIds": [
        "REQ-3"
      ],
      "version": 1
    },
    {
      "id": "feature-create-update-all-specified-page-components-as-static-ui-only-pages-pages-may-contain-input-fields-that-accept-typing-but-must-not-submit-anywhere-must-not-call-any-apis-must-not-use-mock-data-and-must-not-include-role-user-checks",
      "title": "Create/update all specified page components as static UI-only pages. Pages may contain input fields that accept typing, but must not submit anywhere, must not call any APIs, must not use mock data, and must not include role/user checks.",
      "reqIds": [
        "REQ-4"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-a-consistent-shared-visual-layout-across-all-pages-white-background-centered-container-max-width-760-with-generous-padding-top-centered-logo-image-asistenku-horizontal-png-height-32-main-card-with-24px-rounding-subtle-shadow-20-24px-padding-optional-very-thin-border-lots-of-whitespace-keep-the-ui-clean-calm-premium-with-large-rounded-corners-and-soft-shadows-avoid-saas-template-styling-no-sidebars-no-complex-navbars",
      "title": "Implement a consistent shared visual layout across all pages (white background, centered container max-width 760 with generous padding, top centered logo image \"asistenku-horizontal.png\" height 32, main card with 24px rounding, subtle shadow, 20–24px padding, optional very thin border, lots of whitespace). Keep the UI clean, calm, premium, with large rounded corners and soft shadows; avoid SaaS-template styling (no sidebars, no complex navbars).",
      "reqIds": [
        "REQ-5"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-landing-page-ui-exactly-title-ruang-masuk-subtext-pilih-akses-yang-sesuai-two-large-buttons-linking-to-client-login-and-partner-login-labeled-client-login-and-partner-login-below-that-small-text-belum-punya-akun-with-links-daftar-client-client-register-and-daftar-partner-partner-register-and-a-bottom-small-link-internal-internal",
      "title": "Implement Landing page (\"/\") UI exactly: title \"Ruang Masuk\", subtext \"Pilih akses yang sesuai.\", two large buttons linking to \"/client/login\" and \"/partner/login\" labeled \"Client Login\" and \"Partner Login\"; below that small text \"Belum punya akun?\" with links \"Daftar Client\" -> \"/client/register\" and \"Daftar Partner\" -> \"/partner/register\"; and a bottom small link \"Internal\" -> \"/internal\".",
      "reqIds": [
        "REQ-6"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-clientlogin-client-login-ui-title-masuk-subtext-untuk-client-asistenku-render-two-disabled-buttons-labeled-login-internet-identity-disabled-and-masuk-ke-ruang-kerja-disabled-include-link-belum-punya-akun-daftar-client-register-and-link-kembali",
      "title": "Implement ClientLogin (\"/client/login\") UI: title \"Masuk\", subtext \"Untuk Client Asistenku\"; render two disabled buttons labeled \"Login Internet Identity (Disabled)\" and \"Masuk ke ruang kerja (Disabled)\"; include link \"Belum punya akun? Daftar\" -> \"/client/register\" and link \"Kembali\" -> \"/\".",
      "reqIds": [
        "REQ-7"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-clientregister-client-register-ui-title-daftar-subtext-untuk-client-asistenku-static-form-inputs-typable-for-nama-email-whatsapp-perusahaan-disabled-submit-button-labeled-kirim-disabled-link-kembali",
      "title": "Implement ClientRegister (\"/client/register\") UI: title \"Daftar\", subtext \"Untuk Client Asistenku\"; static form inputs (typable) for Nama, Email, WhatsApp, Perusahaan; disabled submit button labeled \"Kirim (Disabled)\"; link \"Kembali\" -> \"/\".",
      "reqIds": [
        "REQ-8"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-partnerlogin-partner-login-ui-mirroring-clientlogin-with-subtext-untuk-partner-asistenku-include-link-to-partner-register-and-link-kembali-include-the-same-two-disabled-buttons-with-the-exact-labels-specified",
      "title": "Implement PartnerLogin (\"/partner/login\") UI mirroring ClientLogin, with subtext \"Untuk Partner Asistenku\"; include link to \"/partner/register\" and link \"Kembali\" -> \"/\"; include the same two disabled buttons with the exact labels specified.",
      "reqIds": [
        "REQ-9"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-partnerregister-partner-register-ui-title-daftar-subtext-untuk-partner-asistenku-static-form-inputs-typable-for-nama-email-whatsapp-domisili-and-a-textarea-keahlian-disabled-button-kirim-disabled-link-kembali",
      "title": "Implement PartnerRegister (\"/partner/register\") UI: title \"Daftar\", subtext \"Untuk Partner Asistenku\"; static form inputs (typable) for Nama, Email, WhatsApp, Domisili and a textarea Keahlian; disabled button \"Kirim (Disabled)\"; link \"Kembali\" -> \"/\".",
      "reqIds": [
        "REQ-10"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-internallanding-internal-ui-title-internal-subtext-akses-internal-asistenku-buttons-linking-to-internal-login-labeled-internal-login-and-to-internal-register-labeled-internal-register-link-kembali",
      "title": "Implement InternalLanding (\"/internal\") UI: title \"Internal\", subtext \"Akses internal Asistenku.\"; buttons linking to \"/internal/login\" labeled \"Internal Login\" and to \"/internal/register\" labeled \"Internal Register\"; link \"Kembali\" -> \"/\".",
      "reqIds": [
        "REQ-11"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-internallogin-internal-login-ui-title-internal-login-subtext-pilih-role-internal-statis-dulu-display-a-selectable-grid-of-roles-superadmin-admin-finance-concierge-asistenmu-with-local-ui-state-only-selection-highlight-only-no-other-effects-include-two-disabled-buttons-labeled-login-internet-identity-disabled-and-ruang-kerja-disabled-link-kembali-internal",
      "title": "Implement InternalLogin (\"/internal/login\") UI: title \"Internal Login\", subtext \"Pilih role internal (statis dulu).\"; display a selectable grid of roles (Superadmin, Admin, Finance, Concierge, Asistenmu) with local UI state only (selection highlight only; no other effects); include two disabled buttons labeled \"Login Internet Identity (Disabled)\" and \"Ruang kerja (Disabled)\"; link \"Kembali\" -> \"/internal\".",
      "reqIds": [
        "REQ-12"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-internalregister-internal-register-ui-title-internal-register-subtext-pendaftaran-internal-statis-dulu-static-form-inputs-typable-for-nama-email-whatsapp-dropdown-role-with-options-admin-finance-concierge-asistenmu-disabled-button-kirim-disabled-link-kembali-internal",
      "title": "Implement InternalRegister (\"/internal/register\") UI: title \"Internal Register\", subtext \"Pendaftaran internal (statis dulu).\"; static form inputs (typable) for Nama, Email, WhatsApp; dropdown role with options admin, finance, concierge, asistenmu; disabled button \"Kirim (Disabled)\"; link \"Kembali\" -> \"/internal\".",
      "reqIds": [
        "REQ-13"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-all-dashboards-as-100-static-empty-pages-with-the-required-mini-header-and-a-single-centered-card-title-per-role-each-dashboard-must-include-a-top-mini-header-inside-the-page-with-left-logo-img-src-asistenku-horizontal-png-height-24-and-right-a-disabled-text-button-logout-disabled-and-a-centered-card-containing-only-the-exact-role-specific-sentence-provided-by-the-user-with-no-tabs-lists-data-or-placeholder-stats",
      "title": "Implement all dashboards as 100% static empty pages with the required mini header and a single centered card title per role. Each dashboard must include: a top mini header inside the page with left logo <img src=\"asistenku-horizontal.png\" height=\"24\" /> and right a disabled text button \"Logout (Disabled)\"; and a centered card containing only the exact role-specific sentence provided by the user, with no tabs, lists, data, or placeholder stats.",
      "reqIds": [
        "REQ-14"
      ],
      "version": 1
    },
    {
      "id": "feature-replace-tanstack-router-usage-with-react-router-react-router-dom-in-frontend-src-app-tsx-using-browserrouter-routes-route-so-the-app-never-crashes-on-initial-load-and-the-route-renders-successfully",
      "title": "Replace TanStack Router usage with React Router (react-router-dom) in frontend/src/App.tsx, using BrowserRouter + Routes + Route, so the app never crashes on initial load and the route \"/\" renders successfully.",
      "reqIds": [
        "REQ-15"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-every-page-component-under-frontend-src-pages-is-exported-as-a-default-react-component-and-that-all-import-paths-in-app-tsx-and-page-files-reference-existing-files-only-no-broken-incorrect-paths",
      "title": "Ensure every page component under frontend/src/pages/** is exported as a default React component and that all import paths in App.tsx and page files reference existing files only (no broken/incorrect paths).",
      "reqIds": [
        "REQ-16"
      ],
      "version": 1
    },
    {
      "id": "feature-remove-usage-of-any-ui-component-libraries-that-may-not-exist-e-g-shadcn-ui-imports-like-button-card-input-select-from-frontend-src-app-tsx-and-all-frontend-src-pages-files-replacing-them-with-plain-html-elements-div-button-input-select-textarea-label-styled-via-classname-only",
      "title": "Remove usage of any UI component libraries that may not exist (e.g., shadcn/ui imports like Button/Card/Input/Select) from frontend/src/App.tsx and all frontend/src/pages/** files, replacing them with plain HTML elements (div/button/input/select/textarea/label) styled via className only.",
      "reqIds": [
        "REQ-17"
      ],
      "version": 1
    },
    {
      "id": "feature-normalize-logo-rendering-across-all-pages-use-only-the-image-file-named-exactly-asistenku-horizontal-png-with-img-src-written-exactly-asistenku-horizontal-png-no-leading-slash-no-folder-and-add-sufficient-top-padding-spacing-so-the-logo-is-never-visually-clipped-covered",
      "title": "Normalize logo rendering across all pages: use only the image file named exactly \"asistenku-horizontal.png\" with img src written exactly \"asistenku-horizontal.png\" (no leading slash, no folder), and add sufficient top padding/spacing so the logo is never visually clipped/covered.",
      "reqIds": [
        "REQ-18"
      ],
      "version": 1
    },
    {
      "id": "feature-perform-a-final-rendering-compile-sanity-pass-after-the-patch-ensure-there-are-no-typescript-react-runtime-errors-no-blank-page-on-load-and-the-landing-page-at-renders-normally",
      "title": "Perform a final rendering/compile sanity pass after the patch: ensure there are no TypeScript/React runtime errors, no blank page on load, and the Landing page at \"/\" renders normally.",
      "reqIds": [
        "REQ-19"
      ],
      "version": 1
    },
    {
      "id": "feature-modify-only-frontend-src-pages-internal-internallogin-tsx-to-implement-the-requested-model-a-internal-login-flow-using-internet-identity-login-and-existing-backend-methods-getcalleruser-issuperadminclaimed-claimsuperadmin-while-keeping-all-other-pages-ui-only-and-unchanged",
      "title": "Modify ONLY `frontend/src/pages/internal/InternalLogin.tsx` to implement the requested “Model A” Internal Login flow using Internet Identity login and existing backend methods (`getCallerUser()`, `isSuperadminClaimed()`, `claimSuperadmin()`) while keeping all other pages UI-only and unchanged.",
      "reqIds": [
        "REQ-83"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-exact-internallogin-ui-state-machine-and-backend-call-sequencing-as-specified-iiloggedin-selectedrole-checking-warningtext-superadminclaimed-claimloading-call-issuperadminclaimed-exactly-once-on-mount-to-set-superadminclaimed-and-do-not-call-getcalleruser-automatically-after-ii-login",
      "title": "Implement the exact InternalLogin UI state machine and backend call sequencing as specified: `iiLoggedIn`, `selectedRole`, `checking`, `warningText`, `superadminClaimed`, `claimLoading`; call `isSuperadminClaimed()` exactly once on mount to set `superadminClaimed` and do not call `getCallerUser()` automatically after II login.",
      "reqIds": [
        "REQ-84"
      ],
      "version": 1
    },
    {
      "id": "feature-update-the-role-card-grid-in-internallogin-tsx-so-it-always-shows-these-clickable-role-cards-and-uses-their-exact-role-keys-for-selection-validation-admin-asistenmu-concierge-strategicpartner-manajer-finance-management-superadmin-clicking-a-card-must-set-selectedrole-to-that-card-s-role-key-and-clear-warningtext-the-superadmin-card-must-always-exist-and-be-selectable",
      "title": "Update the role card grid in `InternalLogin.tsx` so it always shows these clickable role cards and uses their exact role keys for selection/validation: `admin`, `asistenmu`, `concierge`, `strategicpartner`, `manajer`, `finance`, `management`, `superadmin`. Clicking a card must set `selectedRole` to that card’s role key and clear `warningText`. The Superadmin card must always exist and be selectable.",
      "reqIds": [
        "REQ-85"
      ],
      "version": 1
    },
    {
      "id": "feature-enable-the-ruang-kerja-action-with-the-required-gating-and-behavior-it-must-be-enabled-only-when-iiloggedin-true-and-selectedrole-null-on-click-it-must-set-checking-true-clear-warningtext-call-getcalleruser-exactly-once-then-enforce-the-specified-decision-tree-registration-handling-role-mismatch-warning-status-check-for-non-client-partner-superadmin-roles-and-redirect-only-on-successful-match",
      "title": "Enable the “Ruang kerja” action with the required gating and behavior: it must be enabled only when `iiLoggedIn === true` AND `selectedRole !== null`; on click it must set `checking=true`, clear `warningText`, call `getCallerUser()` exactly once, then enforce the specified decision tree (registration handling, role mismatch warning, status check for non-client/partner/superadmin roles) and redirect only on successful match.",
      "reqIds": [
        "REQ-86"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-superadmin-claim-behavior-in-internallogin-tsx-show-a-claim-superadmin-button-only-when-iiloggedin-true-selectedrole-superadmin-and-superadminclaimed-false-on-click-set-claimloading-true-and-clear-warningtext-call-claimsuperadmin-no-parameters-if-it-requires-parameters-in-the-generated-types-pass-empty-placeholder-values-without-adding-any-form-fields-then-handle-success-already-claimed-outcomes-exactly-as-specified-and-redirect-only-on-successful-claim",
      "title": "Implement Superadmin claim behavior in `InternalLogin.tsx`: show a “Claim Superadmin” button only when `iiLoggedIn === true`, `selectedRole === \"superadmin\"`, and `superadminClaimed === false`. On click, set `claimLoading=true` and clear `warningText`, call `claimSuperadmin()` (no parameters; if it requires parameters in the generated types, pass empty/placeholder values without adding any form fields), then handle success/already-claimed outcomes exactly as specified and redirect only on successful claim.",
      "reqIds": [
        "REQ-87"
      ],
      "version": 1
    },
    {
      "id": "feature-implement-the-fixed-dashboard-route-mapping-in-internallogin-tsx-redirects-no-route-changes-elsewhere-admin-admin-dashboard-asistenmu-asistenmu-dashboard-concierge-concierge-dashboard-strategicpartner-strategicpartner-dashboard-manajer-manajer-dashboard-finance-finance-dashboard-management-management-dashboard-superadmin-superadmin-dashboard",
      "title": "Implement the fixed dashboard route mapping in `InternalLogin.tsx` redirects (no route changes elsewhere): admin -> `/admin/dashboard`; asistenmu -> `/asistenmu/dashboard`; concierge -> `/concierge/dashboard`; strategicpartner -> `/strategicpartner/dashboard`; manajer -> `/manajer/dashboard`; finance -> `/finance/dashboard`; management -> `/management/dashboard`; superadmin -> `/superadmin/dashboard`.",
      "reqIds": [
        "REQ-88"
      ],
      "version": 1
    },
    {
      "id": "feature-preserve-the-existing-internallogin-page-s-base-layout-and-styling-logo-centered-container-card-styling-footer-only-add-the-minimum-ui-elements-needed-to-support-the-new-logic-enable-disable-states-per-role-ruang-kerja-placement-either-per-card-or-a-single-shared-button-superadmin-claim-button-in-the-superadmin-card-area-and-a-simple-warning-text-area-displayed-below-the-ruang-kerja-action-area",
      "title": "Preserve the existing InternalLogin page’s base layout and styling (logo, centered container, card styling, footer). Only add the minimum UI elements needed to support the new logic: enable/disable states, per-role “Ruang kerja” placement (either per-card or a single shared button), Superadmin claim button in the Superadmin card area, and a simple warning text area displayed below the “Ruang kerja” action area.",
      "reqIds": [
        "REQ-89"
      ],
      "version": 1
    },
    {
      "id": "feature-ensure-the-change-compiles-and-runs-without-runtime-errors-including-when-the-user-is-not-logged-in-anonymous-actor-when-backend-calls-fail-and-when-backend-return-types-differ-by-variant-handle-results-defensively-in-internallogin-tsx-without-changing-shared-hooks",
      "title": "Ensure the change compiles and runs without runtime errors, including when the user is not logged in (anonymous actor), when backend calls fail, and when backend return types differ by variant (handle results defensively in `InternalLogin.tsx` without changing shared hooks).",
      "reqIds": [
        "REQ-90"
      ],
      "version": 1
    },
    {
      "id": "feature-update-frontend-src-pages-internal-internallogin-tsx-so-the-claim-superadmin-action-calls-only-the-backend-method-actor-claimsuperadmin-and-does-not-call-directly-or-indirectly-from-this-click-handler-any-profile-role-assignment-methods-such-as-savecalleruserprofile-that-can-trigger-the-backend-error-unauthorized-only-admins-can-assign-user-roles",
      "title": "Update `frontend/src/pages/internal/InternalLogin.tsx` so the \"Claim Superadmin\" action calls ONLY the backend method `actor.claimSuperadmin()` and does not call (directly or indirectly from this click handler) any profile/role-assignment methods such as `saveCallerUserProfile()` that can trigger the backend error \"Unauthorized: Only admins can assign user roles\".",
      "reqIds": [
        "REQ-91"
      ],
      "version": 1
    },
    {
      "id": "feature-in-frontend-src-pages-internal-internallogin-tsx-add-a-one-time-on-mount-check-that-calls-actor-issuperadminclaimed-exactly-once-when-an-actor-is-available-and-uses-its-result-to-set-superadminclaimed-so-the-claim-ui-is-only-offered-when-superadmin-has-not-yet-been-claimed",
      "title": "In `frontend/src/pages/internal/InternalLogin.tsx`, add a one-time on-mount check that calls `actor.isSuperadminClaimed()` exactly once (when an actor is available) and uses its result to set `superadminClaimed`, so the claim UI is only offered when superadmin has not yet been claimed.",
      "reqIds": [
        "REQ-92"
      ],
      "version": 1
    },
    {
      "id": "feature-harden-frontend-src-pages-internal-internallogin-tsx-against-actor-readiness-issues-prevent-backend-calls-for-claim-check-actions-when-the-actor-is-still-initializing-and-show-a-non-crashing-inline-warning-instead-of-attempting-the-call",
      "title": "Harden `frontend/src/pages/internal/InternalLogin.tsx` against actor readiness issues: prevent backend calls for claim/check actions when the actor is still initializing, and show a non-crashing inline warning instead of attempting the call.",
      "reqIds": [
        "REQ-93"
      ],
      "version": 1
    },
    {
      "id": "feature-update-only-frontend-src-pages-internal-internallogin-tsx-to-show-a-dedicated-separate-claim-superadmin-card-section-that-does-not-require-selecting-the-superadmin-role-first-the-claim-section-must-be-visible-only-when-the-user-is-logged-in-with-internet-identity-iiloggedin-true-the-one-time-claim-check-has-completed-claimcheckdone-true-and-superadminclaimed-false",
      "title": "Update ONLY `frontend/src/pages/internal/InternalLogin.tsx` to show a dedicated, separate \"Claim Superadmin\" card/section that does not require selecting the \"superadmin\" role first. The claim section must be visible only when the user is logged in with Internet Identity (`iiLoggedIn === true`), the one-time claim-check has completed (`claimCheckDone === true`), and `superadminClaimed === false`.",
      "reqIds": [
        "REQ-94"
      ],
      "version": 1
    },
    {
      "id": "feature-in-frontend-src-pages-internal-internallogin-tsx-harden-the-claim-superadmin-click-handler-so-it-never-calls-the-backend-when-the-actor-is-not-ready-if-actor-is-null-undefined-or-actorfetching-is-true-the-handler-must-exit-early-and-show-a-non-crashing-inline-warning-reuse-the-existing-warning-mechanism-instead-of-attempting-the-call",
      "title": "In `frontend/src/pages/internal/InternalLogin.tsx`, harden the \"Claim Superadmin\" click handler so it never calls the backend when the actor is not ready. If `actor` is null/undefined OR `actorFetching` is true, the handler must exit early and show a non-crashing inline warning (reuse the existing warning mechanism) instead of attempting the call.",
      "reqIds": [
        "REQ-95"
      ],
      "version": 1
    },
    {
      "id": "feature-keep-the-superadmin-claim-mutation-behavior-unchanged-except-for-the-ui-placement-the-claim-action-must-call-only-actor-claimsuperadmin-and-must-not-call-any-other-backend-mutation-directly-or-indirectly-on-success-set-superadminclaimed-true-hide-the-claim-card-and-navigate-to-superadmin-dashboard-if-the-backend-indicates-the-superadmin-is-already-claimed-set-superadminclaimed-true-hide-the-claim-card-and-show-an-inline-warning-message-no-redirect-in-that-case",
      "title": "Keep the Superadmin claim mutation behavior unchanged except for the UI placement: the claim action must call ONLY `actor.claimSuperadmin()` and must not call any other backend mutation (directly or indirectly). On success, set `superadminClaimed = true`, hide the claim card, and navigate to `/superadmin/dashboard`. If the backend indicates the superadmin is already claimed, set `superadminClaimed = true`, hide the claim card, and show an inline warning message (no redirect in that case).",
      "reqIds": [
        "REQ-96"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-1",
      "summary": "Implement static frontend UI pages and routing per spec (Landing, Client/Partner Login/Register, Internal Landing/Login/Register, role Dashboards, and 404) with no backend interaction.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-2",
      "summary": "Build backend/main.mo (single file) implementing superadmin claim (principal-only), user registrations/profiles for client/partner/internal, status update rules, partner level+rate rules, master data (pekerjaan) CRUD with validations, and kalkulator AM query per spec; do not modify any frontend files.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-3",
      "summary": "Update only backend/main.mo to implement the complete backend specification provided by the user, including: locked constants, exact type definitions, stable storage (arrays only), required helper functions (time, ID generation, validations, parsing, lookups, auth gates), and all public methods with the exact names, signatures, and return values described.",
      "reqIds": [
        "REQ-20"
      ],
      "status": "pending"
    },
    {
      "id": "AR-4",
      "summary": "Revert all unintended frontend changes to restore zero diff in frontend; then implement a clean minimal backend in backend/main.mo only (no new files, no migrations, do not touch backend/authorization/*), enforcing 1 principalId=1 role, userId separate from principalId except superadmin, role-specific profile fields, first-claim superadmin, register per role + getCallerUser, and rename \"kerjaan\" -> \"pekerjaan\" throughout master data.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-5",
      "summary": "Ensure this change set modifies ONLY backend/main.mo. All frontend files must have zero diff versus the pre-patch state, no new files may be created anywhere, backend/authorization/* must not be edited, and no migration file may be added or used.",
      "reqIds": [
        "REQ-21"
      ],
      "status": "pending"
    },
    {
      "id": "AR-6",
      "summary": "Rewrite backend/main.mo as a clean, minimal \"master backend\" implementing a final identity model where 1 principalId maps to exactly 1 role, with a separate userId stored for all roles except superadmin.",
      "reqIds": [
        "REQ-22"
      ],
      "status": "pending"
    },
    {
      "id": "AR-7",
      "summary": "Implement role-specific profile types/fields that match the existing frontend forms exactly: Client has name, email, whatsapp, company; Partner has name, email, whatsapp, keahlian, domisili; Internal has name, email, whatsapp, role (superadmin/admin/finance/concierge/asistenmu); Superadmin has only principalId (no whatsapp/company/keahlian/domusili/etc).",
      "reqIds": [
        "REQ-23"
      ],
      "status": "pending"
    },
    {
      "id": "AR-8",
      "summary": "Provide public registration functions per role—registerClient, registerPartner, and registerInternal—that register the caller principal exactly once into the corresponding role and store the appropriate profile fields.",
      "reqIds": [
        "REQ-24"
      ],
      "status": "pending"
    },
    {
      "id": "AR-9",
      "summary": "Provide a public getCallerUser function that returns the caller's current role and stored user information so the frontend (later) can check the caller's role; if the caller is not registered, it must return an explicit empty/none response (not a misleading default).",
      "reqIds": [
        "REQ-25"
      ],
      "status": "pending"
    },
    {
      "id": "AR-10",
      "summary": "Implement superadmin claiming as a dedicated public function (e.g., claimSuperadmin) that can be executed only once globally (first claim wins) and requires no additional fields; subsequent calls must be rejected.",
      "reqIds": [
        "REQ-26"
      ],
      "status": "pending"
    },
    {
      "id": "AR-11",
      "summary": "Rename all occurrences of the master-data term \"kerjaan\" to \"pekerjaan\" inside backend/main.mo (types, fields, and function names). If master-data logic is not present in this clean backend, ensure there are no 'kerjaan' identifiers remaining in backend/main.mo.",
      "reqIds": [
        "REQ-27"
      ],
      "status": "pending"
    },
    {
      "id": "AR-12",
      "summary": "Keep the backend minimal and clean: remove prior authorization-gate logic tied to backend/authorization/* from backend/main.mo (do not edit backend/authorization/*), and avoid adding any non-requested domains such as services/tasks.",
      "reqIds": [
        "REQ-28"
      ],
      "status": "pending"
    },
    {
      "id": "AR-13",
      "summary": "Patch backend/main.mo ONLY to remove all Migration usage (delete `import Migration \"migration\";` and remove `(with migration = Migration.run)`), making the canister a plain `actor { ... }` without other changes.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-14",
      "summary": "Update ONLY `backend/main.mo` to remove all Migration usage by deleting `import Migration \"migration\";` and removing any actor migration clause `(with migration = Migration.run)`, resulting in a plain `actor { ... }` declaration, without changing anything else in the file.",
      "reqIds": [
        "REQ-29"
      ],
      "status": "pending"
    },
    {
      "id": "AR-15",
      "summary": "Patch backend/main.mo only: add nextUserId counter + genUserId() helper, and update registerClient/registerPartner/registerInternal to ignore any incoming userId and always store userId = genUserId(), without changing other logic (keep 1 principalId = 1 role).",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-16",
      "summary": "Modify ONLY backend/main.mo to add an in-canister incremental user ID counter and generator: add `var nextUserId : Nat = 1;` and add `func genUserId() : Text { let id = nextUserId; nextUserId += 1; return \"U\" # Nat.toText(id); }`. Ensure required imports exist (e.g., Nat) so the file compiles.",
      "reqIds": [
        "REQ-30"
      ],
      "status": "pending"
    },
    {
      "id": "AR-17",
      "summary": "In backend/main.mo, update registerClient, registerPartner, and registerInternal so that they ignore any incoming `userId` value (if present in the incoming argument type) and always store `userId = genUserId()` in the stored profile record.",
      "reqIds": [
        "REQ-31"
      ],
      "status": "pending"
    },
    {
      "id": "AR-18",
      "summary": "Do not change any other logic in backend/main.mo beyond the additions/changes required to support the generated userId assignment, and keep the existing rule that one principalId maps to exactly one role unchanged.",
      "reqIds": [
        "REQ-32"
      ],
      "status": "pending"
    },
    {
      "id": "AR-19",
      "summary": "Disable saveCallerUserProfile in backend/main.mo: keep the same signature but make it always Runtime.trap(...) so it can never overwrite userRoles/profile.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-20",
      "summary": "Adjust role typing so superadmin is not part of InternalRole (InternalRole only admin/finance/concierge/asistenmu) while UserRole still includes #superadmin; keep InternalProfile fields unchanged.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-21",
      "summary": "Implement userId system in backend/main.mo using nextUserId counter + userIdByPrincipal map + genUserId/ensureUserId helpers, with userId NOT stored in Client/Partner/Internal profile records; call ensureUserId(caller) in all register* and claimSuperadmin flows.",
      "reqIds": [],
      "status": "in_progress"
    },
    {
      "id": "AR-22",
      "summary": "Add public query getMyUserId() in backend/main.mo returning ?Text from userIdByPrincipal for the caller (null if none).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-23",
      "summary": "Modify ONLY `backend/main.mo` to disable `saveCallerUserProfile(profile : UserRole)` while preserving its exact public signature, by making the function always call `Runtime.trap(\"Disabled: profile saving must use register* or admin-approved flows only.\");` and removing any `userRoles.add(...)`/write behavior from this function.",
      "reqIds": [
        "REQ-33"
      ],
      "status": "pending"
    },
    {
      "id": "AR-24",
      "summary": "Update role typing in `backend/main.mo` so that `InternalRole` contains ONLY `#admin`, `#finance`, `#concierge`, and `#asistenmu`, and does NOT include `#superadmin`. Keep `UserRole`'s `#superadmin` variant unchanged. Keep `InternalProfile` unchanged (fields: name, email, whatsapp, role: InternalRole) with no new fields added.",
      "reqIds": [
        "REQ-34"
      ],
      "status": "pending"
    },
    {
      "id": "AR-25",
      "summary": "Add an automatic, consistent `userId` system in `backend/main.mo` without adding `userId` fields to any profile record types. Implement storage and helpers exactly as specified: (1) `var nextUserId : Nat = 1;` (2) `let userIdByPrincipal = Map.empty<Principal, Text>();` located near `let userRoles = ...` (3) `func genUserId() : Text` that returns `\"U\" + Nat` (e.g., `U1`, `U2`, ...) and increments `nextUserId` (4) `func ensureUserId(p : Principal) : Text` that returns an existing ID if present in the map, otherwise generates, stores, and returns a new ID.",
      "reqIds": [
        "REQ-35"
      ],
      "status": "pending"
    },
    {
      "id": "AR-26",
      "summary": "Ensure `ignore ensureUserId(caller);` is executed immediately before any `userRoles.add(caller, entry);` in ALL existing registration functions (`registerClient`, `registerPartner`, `registerInternal`) and also in `claimSuperadmin()` before setting `superadminClaimed := true;`. Do not change the existing rule that one principal can only register exactly one role, and keep the rest of the core logic unchanged.",
      "reqIds": [
        "REQ-36"
      ],
      "status": "pending"
    },
    {
      "id": "AR-27",
      "summary": "Add a new query method in the “User Queries” section of `backend/main.mo`: `public query ({ caller }) func getMyUserId() : async ?Text { userIdByPrincipal.get(caller); }` returning `null` if the caller has no userId and `?Text` if present (including superadmin).",
      "reqIds": [
        "REQ-37"
      ],
      "status": "pending"
    },
    {
      "id": "AR-28",
      "summary": "APPEND-ONLY patch to backend/main.mo: without modifying any existing line, append the provided “MASTER DATA (EMPTY DEFAULT) — SUPERADMIN ONLY” section immediately before the actor’s final closing brace `}`; do not touch migration.mo or add Migration imports/actor migration clauses; master-data CRUD/query functions must be superadmin-principal-only and must not create/store any superadmin profile fields.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-29",
      "summary": "Update ONLY `backend/main.mo` using an APPEND-ONLY patch: preserve 100% of the existing file content byte-for-byte (no edits, deletions, reordering, formatting changes, or refactors), and append the user-provided “MASTER DATA (EMPTY DEFAULT) — SUPERADMIN ONLY” section EXACTLY at the very bottom of the actor, immediately before the final closing brace `}`.",
      "reqIds": [
        "REQ-38"
      ],
      "status": "pending"
    },
    {
      "id": "AR-30",
      "summary": "Ensure the appended Master Data APIs are superadmin-principal-only and do not create or store any superadmin profile data (no email/WhatsApp/profile auto-creation), exactly as expressed in the appended code (e.g., `requireSuperadmin` gate and role check against `userRoles`).",
      "reqIds": [
        "REQ-39"
      ],
      "status": "pending"
    },
    {
      "id": "AR-31",
      "summary": "Append-only Master Data Asistenku block to backend/main.mo (below existing SYSTEM MASTER DATA section): add Indonesian types (TipePartner, SkillVerified, KamusPekerjaan, AturanBebanPerusahaan, KonstantaUnitClient), new Map-based storage + ID generators (SKL-/KMS-/ATB- with pad4), superadmin-only CRUD/list endpoints for skills/kamus/aturan, konstanta unit get/set, partner verified skills mapping management, and kalkulatorAM per specified rules; all methods must call existing requireSuperadmin(caller).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-32",
      "summary": "Append (append-only) a new “Master Data Asistenku” implementation block to the VERY END of backend/main.mo, placed below the existing “SYSTEM MASTER DATA (EMPTY DEFAULT) - SUPERADMIN ONLY” section and immediately before the actor’s final closing brace `}`. Do not modify, delete, reorder, or reformat any existing line in backend/main.mo.",
      "reqIds": [
        "REQ-40"
      ],
      "status": "pending"
    },
    {
      "id": "AR-33",
      "summary": "In the appended block, define the requested Indonesian-named types exactly: `TipePartner = { #junior; #senior; #expert }`; `SkillVerified = { kode: Text; nama: Text; kategori: Text; aktif: Bool; createdAt: Int }`; `KamusPekerjaan = { kategoriPekerjaan: Text; jenisPekerjaan: Text; jamStandar: Nat; tipePartnerBoleh: [TipePartner]; aktif: Bool; createdAt: Int }`; `AturanBebanPerusahaan = { tipePartner: TipePartner; jamMin: Nat; jamMax: Nat; polaBeban: { #TAMBAH_JAM_TETAP; #TAMBAH_PER_JAM }; nilai: Nat; aktif: Bool; createdAt: Int }`; `KonstantaUnitClient = { unitKeJamPerusahaan: Nat; updatedAt: Int }`.",
      "reqIds": [
        "REQ-41"
      ],
      "status": "pending"
    },
    {
      "id": "AR-34",
      "summary": "In the appended block, add the requested in-canister storage using the already-available `Map` (from `mo:core/Map` as confirmed by the user): `var nextSkillId : Nat = 1; var nextKamusId : Nat = 1; var nextAturanId : Nat = 1; let skillsByKode = Map.empty<Text, SkillVerified>(); let kamusByKode = Map.empty<Text, KamusPekerjaan>(); let aturanByKode = Map.empty<Text, AturanBebanPerusahaan>(); var konstantaUnit : KonstantaUnitClient = { unitKeJamPerusahaan = 2; updatedAt = 0 }; let partnerSkillsByPrincipal = Map.empty<Principal, [Text]>();`",
      "reqIds": [
        "REQ-42"
      ],
      "status": "pending"
    },
    {
      "id": "AR-35",
      "summary": "In the appended block, implement helper functions exactly named: `pad4(n: Nat) : Text`, `genKode(prefix: Text, id: Nat) : Text` (producing codes like `SKL-0001`), and `now() : Int` (use `Time.now()` if available in the file’s imports; otherwise use a compile-safe fallback).",
      "reqIds": [
        "REQ-43"
      ],
      "status": "pending"
    },
    {
      "id": "AR-36",
      "summary": "Append superadmin-only public methods for “Skill Verified” with exact names/signatures/behaviors, each calling `requireSuperadmin(caller : Principal)` at the start: `upsertSkillVerified(kodeOpt:?Text, nama:Text, kategori:Text, aktif:Bool) : async Text` (create when null by generating `SKL-` code from `nextSkillId`, incrementing the counter; update only if code exists; return `kode`), `getSkillVerified(kode:Text) : async ?SkillVerified`, `listSkillVerified() : async [SkillVerified]`.",
      "reqIds": [
        "REQ-44"
      ],
      "status": "pending"
    },
    {
      "id": "AR-37",
      "summary": "Append superadmin-only public methods for “Kamus Pekerjaan” with exact names/signatures/behaviors, each calling `requireSuperadmin(caller)` at the start: `upsertKamusPekerjaan(kodeOpt:?Text, kategoriPekerjaan:Text, jenisPekerjaan:Text, jamStandar:Nat, tipePartnerBoleh:[TipePartner], aktif:Bool) : async Text` (create `KMS-` + 4 digits from `nextKamusId`; update only if code exists; return code), `getKamusPekerjaan(kode:Text) : async ?KamusPekerjaan`, `listKamusPekerjaan() : async [KamusPekerjaan]`.",
      "reqIds": [
        "REQ-45"
      ],
      "status": "pending"
    },
    {
      "id": "AR-38",
      "summary": "Append superadmin-only public methods for “Aturan Beban Perusahaan” with exact names/signatures/behaviors, each calling `requireSuperadmin(caller)` at the start: `upsertAturanBeban(kodeOpt:?Text, tipePartner:TipePartner, jamMin:Nat, jamMax:Nat, polaBeban:{#TAMBAH_JAM_TETAP;#TAMBAH_PER_JAM}, nilai:Nat, aktif:Bool) : async Text` (create `ATB-` code from `nextAturanId`; update only if code exists; return code), `getAturanBeban(kode:Text) : async ?AturanBebanPerusahaan`, `listAturanBeban() : async [AturanBebanPerusahaan]`.",
      "reqIds": [
        "REQ-46"
      ],
      "status": "pending"
    },
    {
      "id": "AR-39",
      "summary": "Append superadmin-only public methods for “Konstanta Unit Client”, each calling `requireSuperadmin(caller)` at the start: `setKonstantaUnitClient(unitKeJamPerusahaan:Nat) : async ()` (update `konstantaUnit.unitKeJamPerusahaan` and set `updatedAt = now()`), and `getKonstantaUnitClient() : async KonstantaUnitClient` (return current value).",
      "reqIds": [
        "REQ-47"
      ],
      "status": "pending"
    },
    {
      "id": "AR-40",
      "summary": "Append superadmin-only public methods to manage verified skills per Partner principal, each calling `requireSuperadmin(caller)` at the start: `setPartnerVerifiedSkills(partner:Principal, skillCodes:[Text]) : async ()` (validate each code exists in `skillsByKode` and has `aktif = true`, otherwise trap; then overwrite full list in `partnerSkillsByPrincipal`), `getPartnerVerifiedSkills(partner:Principal) : async [Text]` (return list or empty array if none), and `listPartnerVerifiedSkills() : async [(Principal, [Text])]` (return full map entries).",
      "reqIds": [
        "REQ-48"
      ],
      "status": "pending"
    },
    {
      "id": "AR-41",
      "summary": "Append an optional superadmin-only helper method `kalkulatorAM(kodeKamus:Text, tipePartner:TipePartner, beban:Nat) : async { jamKePartner: Nat; jamPerusahaan: Nat; unitClient: Nat }`, gated by `requireSuperadmin(caller)`, implementing the specified calculation rules: look up `KamusPekerjaan` by `kodeKamus` and use `jamStandar`; find exactly one active `AturanBebanPerusahaan` matching `tipePartner` where `jamStandar` is within `[jamMin..jamMax]` inclusive (trap if none); compute `J = jamStandar * beban`; compute `bebanInternal` as `nilai` if `#TAMBAH_JAM_TETAP` else `nilai * jamStandar` if `#TAMBAH_PER_JAM`; set `jamKePartner = J`, `jamPerusahaan = J + bebanInternal`; set `unitClient = jamPerusahaan / konstantaUnit.unitKeJamPerusahaan` using integer division.",
      "reqIds": [
        "REQ-49"
      ],
      "status": "pending"
    },
    {
      "id": "AR-42",
      "summary": "Ensure every new method introduced by the appended Master Data Asistenku block calls the existing `requireSuperadmin(caller : Principal)` function (already present in backend/main.mo) and does not expose any Master Data information to non-superadmin callers.",
      "reqIds": [
        "REQ-50"
      ],
      "status": "pending"
    },
    {
      "id": "AR-43",
      "summary": "Do not create or edit backend/migration.mo and do not add any migration-related imports or actor migration clauses as part of this change.",
      "reqIds": [
        "REQ-51"
      ],
      "status": "pending"
    },
    {
      "id": "AR-44",
      "summary": "Append-only (bottom-of-file) backend/main.mo patch adding: (1) UserStatus tracking with default pending fallback, admin/superadmin-gated set/get/list (including listUsersByStatus), forbidding changes to superadmin status; (2) Partner level (TipePartner) + fixed hourly rates with admin/superadmin setters and partner self-queries; (3) admin/superadmin-only userId lookup/listUsersBasic using existing role storage + existing userId map (no new id creation except optional ensureUserId if already present).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-45",
      "summary": "Update ONLY `backend/main.mo` via an append-only patch: append all new Motoko code at the very bottom of the actor, immediately before the final closing brace `}`. Do not change, delete, reorder, or refactor any existing line in `backend/main.mo`, and do not modify any other file.",
      "reqIds": [
        "REQ-52"
      ],
      "status": "pending"
    },
    {
      "id": "AR-46",
      "summary": "In the appended section, add User Status foundations using new storage maps only (no profile changes, no role system changes): define `public type UserStatus = { #pending; #active; #suspended; #blacklisted }`, define fixed-rate constants `public let RATE_JUNIOR : Nat = 35000`, `RATE_SENIOR : Nat = 55000`, `RATE_EXPERT : Nat = 75000`, and add `userStatusByPrincipal : Map<Principal, UserStatus>` plus helper functions `defaultUserStatus`, `getUserStatusInternal`, `isPartnerRole` (must use the existing `userRoles` storage), and `requireAdminOrSuperadmin` (must authorize only existing superadmin/admin per current role storage). Implement public methods exactly as specified: `setUserStatus`, `getMyUserStatus`, `getUserStatus`, and `listUsersByStatus` with the required gates and trap messages.",
      "reqIds": [
        "REQ-53"
      ],
      "status": "pending"
    },
    {
      "id": "AR-47",
      "summary": "In the appended section, add Partner Level + Hourly Rate foundations using the existing `TipePartner` type already defined in `backend/main.mo` (do not redefine it). Add new storage `partnerLevelByPrincipal : Map<Principal, TipePartner>`. Implement public methods exactly as specified: `setPartnerLevel`, `getMyPartnerLevel`, `getPartnerLevel`, `getHourlyRateByLevel`, and `getMyHourlyRate`, including required gates, partner-role validation via existing role storage, and default `#junior` when level is unset.",
      "reqIds": [
        "REQ-54"
      ],
      "status": "pending"
    },
    {
      "id": "AR-48",
      "summary": "In the appended section, implement admin/superadmin-only UserId lookup utilities using the existing `userIdByPrincipal` map and existing role storage (`userRoles`) without creating any new userId system: implement `getUserIdByPrincipal(target)` returning existing userId or null (must not call `ensureUserId`), and `listUsersBasic(roleFilter)` returning `[(Principal, Text, Text, UserStatus)]` for users with a resolvable roleText and existing userId, with status from `getUserStatusInternal` and optional role filter applied via Text comparison.",
      "reqIds": [
        "REQ-55"
      ],
      "status": "pending"
    },
    {
      "id": "AR-49",
      "summary": "Append-only backend/main.mo: add minimal LayananAsistenku module (no migration changes, no refactors, no 'service' word) including LayananType & LayananAsistenku types, Map-based storage/index, stable counter + nextLayananId (LAY-000001) with pad6/now reuse-if-exists, requireSuperadminOrAdmin gate reuse, and methods createLayananForClient, setLayananActive, listMyLayanan (client-only via existing role map). Stop with exact output 'STOP — name conflict' if any required name already exists.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-50",
      "summary": "Update ONLY `backend/main.mo` by appending a minimal, production-safe LayananAsistenku implementation immediately before the actor’s final closing brace `}` (append-only; do not modify/reorder/delete any existing lines). The appended code must define the new types `LayananType` and `LayananAsistenku` exactly as specified, add Map-based storage (`layananById`, `layananIdsByClient`), add a stable counter `layananCounter` and an ID generator `nextLayananId()` producing IDs in the format `LAY-000001`, and add the public methods `createLayananForClient`, `setLayananActive`, and `listMyLayanan` with the exact authorization and behaviors specified. The word \"service\" must not appear anywhere in the new code; use only \"LayananAsistenku\" naming.",
      "reqIds": [
        "REQ-56"
      ],
      "status": "pending"
    },
    {
      "id": "AR-51",
      "summary": "Append-only backend/main.mo: add \"LAYANAN ASISTENKU V2\" block defining LayananMeta type, new Map storages (layananMetaById, layananIdsByOwnerClient), helper reuse/conditional defs (now(), requireAdminOrSuperadminImpl), and V2 methods createLayananForClientV2/setLayananActiveV2/listMyLayananV2/getLayananMeta/getMyLayananMeta; must not touch existing LayananAsistenku v1 types/functions/storage and must not reference migration.mo.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-52",
      "summary": "Append a new append-only section at the very bottom of backend/main.mo (immediately before the actor’s final closing brace) with the exact header comment `// --- LAYANAN ASISTENKU V2 (APPEND ONLY, NO MIGRATION) ---`, then add the new public type `LayananMeta` exactly as specified (without modifying the existing `LayananAsistenku` type).",
      "reqIds": [
        "REQ-57"
      ],
      "status": "pending"
    },
    {
      "id": "AR-53",
      "summary": "In the same appended V2 block in backend/main.mo, add new in-canister storage maps exactly named and typed: `let layananMetaById = Map.empty<Text, LayananMeta>();` and `let layananIdsByOwnerClient = Map.empty<Principal, [Text]>();`.",
      "reqIds": [
        "REQ-58"
      ],
      "status": "pending"
    },
    {
      "id": "AR-54",
      "summary": "In the appended V2 block, reuse existing helper functions if already present; only define them if not already present: (1) `func now() : Int` using `Time.now()`; (2) `func requireAdminOrSuperadminImpl(caller : Principal)` that enforces the same authorization logic as the existing admin/superadmin gate in backend/main.mo (e.g., by calling existing `isAdmin`/`isSuperadmin` if those exist, or by reusing the existing `requireAdminOrSuperadminImpl` if already defined).",
      "reqIds": [
        "REQ-59"
      ],
      "status": "pending"
    },
    {
      "id": "AR-55",
      "summary": "Append the following new public methods in the appended V2 block, with the exact names, signatures, and return values specified, and with the specified behavior:\n\n1) `public shared({caller}) func createLayananForClientV2(ownerClient : Principal, layananId : Text, unitTotal : Nat) : async Text`\n- Gate with `requireAdminOrSuperadminImpl(caller)`\n- Validate `layananId` exists in the existing `layananById`; if missing return exactly `\"LAYANAN_NOT_FOUND\"`\n- Create/update meta (overwrite allowed) in `layananMetaById` with: `unitUsed = 0`, `unitOnHold = 0`, `isActive = true`, `createdAt = now()`, `updatedAt = now()` and the provided `ownerClient`, `unitTotal`, `layananId`\n- Ensure `layananId` is present in `layananIdsByOwnerClient[ownerClient]`; append only if not already present\n- Return exactly `\"OK\"`\n\n2) `public shared({caller}) func setLayananActiveV2(layananId : Text, isActive : Bool) : async Text`\n- Gate with `requireAdminOrSuperadminImpl(caller)`\n- If `layananMetaById` has no entry for `layananId`, return exactly `\"NOT_FOUND\"`\n- Otherwise update only `isActive` and `updatedAt` (keep other fields unchanged) and return exactly `\"OK\"`\n\n3) `public query({caller}) func listMyLayananV2() : async [Text]`\n- Caller must be authenticated using the same check style used by the existing `listMyLayanan`\n- Return `layananIdsByOwnerClient[caller]` or `[]` if missing\n\n4) `public query({caller}) func getLayananMeta(layananId : Text) : async ?LayananMeta`\n- Gate with `requireAdminOrSuperadminImpl(caller)`\n- Return `layananMetaById.get(layananId)`\n\n5) `public query({caller}) func getMyLayananMeta(layananId : Text) : async ?LayananMeta`\n- Caller must be authenticated\n- Return the meta only if it exists and `meta.ownerClient == caller`, otherwise return `null`.",
      "reqIds": [
        "REQ-60"
      ],
      "status": "pending"
    },
    {
      "id": "AR-56",
      "summary": "Append-only backend/main.mo: add “TASK FLOW V1 (APPEND ONLY, NO MIGRATION)” implementing TaskPhase/Task, task storage/indexes and TSK- ID generation, role-based gates (client/partner/asistenmu/admin/superadmin) reusing existing patterns, read-only checks against existing LayananMeta V2 for active/ownership + unit availability/holds, task lifecycle methods (create/cancel/delegate/accept/reject/moveToQa/moveToReviewClient/requestRevisiInternal/requestRevisiClient/backToProgressFromRevisi/clientMarkSelesai), and queries (listMyTasks/getTask). Must not reference migration.mo, must not use the word \"service\", must not modify existing LayananAsistenku or LayananMeta V2 types/maps/methods, and must output exactly \"STOP — name conflict\" if any required new type/func name already exists.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-57",
      "summary": "Update ONLY `backend/main.mo` by appending a new section exactly titled `// --- TASK FLOW V1 (APPEND ONLY, NO MIGRATION) ---` at the very bottom of the actor (immediately before the actor’s final closing brace `}`), without modifying, deleting, reordering, or reformatting any existing line of code.",
      "reqIds": [
        "REQ-61"
      ],
      "status": "pending"
    },
    {
      "id": "AR-58",
      "summary": "Do not create, modify, import, or reference `backend/migration.mo` or any migration-related code (no OldActor/NewActor/run/transform/upgrade patterns) anywhere in the change.",
      "reqIds": [
        "REQ-62"
      ],
      "status": "pending"
    },
    {
      "id": "AR-59",
      "summary": "Before adding any new identifiers from the TASK FLOW V1 spec, verify that none of the required new type names or function names already exist in `backend/main.mo`. If ANY name conflict exists for the required new names, stop and output exactly `STOP — name conflict`.",
      "reqIds": [
        "REQ-63"
      ],
      "status": "pending"
    },
    {
      "id": "AR-60",
      "summary": "In the appended TASK FLOW V1 block, do not use the word \"service\" anywhere (including comments, identifiers, or strings). Use existing domain naming such as `LayananAsistenku` and `LayananMeta` only.",
      "reqIds": [
        "REQ-64"
      ],
      "status": "pending"
    },
    {
      "id": "AR-61",
      "summary": "Implement TASK FLOW V1 types in the appended block (ONLY if the type names do not already exist): `public type TaskPhase = { #permintaan_baru; #ditolak_partner; #on_progress; #qa_asistenku; #review_client; #revisi; #selesai; #dibatalkan_client; };` and `public type Task = { taskId: Text; ownerClient: Principal; layananId: Text; title: Text; detail: Text; requestType: Text; phase: TaskPhase; assignedPartner: ?Principal; jamEfektif: ?Nat; unitTerpakai: ?Nat; breakdownAM: ?Text; lastRejectReason: ?Text; createdAt: Int; updatedAt: Int; };`.",
      "reqIds": [
        "REQ-65"
      ],
      "status": "pending"
    },
    {
      "id": "AR-62",
      "summary": "Add TASK FLOW V1 storage and indexes in the appended block: `stable var taskCounter : Nat = 0;`, `let taskById = Map.empty<Text, Task>();`, `let taskIdsByClient = Map.empty<Principal, [Text]>();`, and `let taskIdsByPartner = Map.empty<Principal, [Text]>();`.",
      "reqIds": [
        "REQ-66"
      ],
      "status": "pending"
    },
    {
      "id": "AR-63",
      "summary": "In the appended TASK FLOW V1 block, implement the required helper functions ONLY if missing; otherwise, reuse existing ones: `now() : Int`, `pad6(n: Nat) : Text`, `nextTaskId() : Text` (format `TSK-` + 6 digits; increments `taskCounter`), role/registration guards (`requireRegistered`, `requireClientRole`, `requireAsistenmuRole`, `requirePartnerRole`, `requireAdminOrSuperadmin`), and index helpers (`appendUniquePrincipalIndex(map: Map<Principal,[Text]>, key: Principal, id: Text) : ()`, and `appendUniqueTextIndex(map: Map<Text,[Text]>, key: Text, id: Text) : ()` only if needed).",
      "reqIds": [
        "REQ-67"
      ],
      "status": "pending"
    },
    {
      "id": "AR-64",
      "summary": "Implement LayananMeta V2 read-only checks in the appended TASK FLOW V1 block WITHOUT modifying any existing `LayananAsistenku` or `LayananMeta V2` types/maps/methods. Add helper `requireLayananActiveForClient(owner: Principal, layananId: Text) : async Bool` that reads `layananMetaById.get(layananId)` and returns true only when meta exists, `meta.ownerClient == owner`, and `meta.isActive == true`. Add helper `availableUnit(meta: LayananMeta) : Nat` computing `meta.unitTotal - meta.unitUsed - meta.unitOnHold`, treating underflow as 0.",
      "reqIds": [
        "REQ-68"
      ],
      "status": "pending"
    },
    {
      "id": "AR-65",
      "summary": "Implement the TASK FLOW V1 lifecycle methods in the appended block with the exact public names, parameters, and return strings described: `createTask`, `cancelTask`, `delegateTask`, `partnerAccept`, `partnerReject`, `moveToQa`, `moveToReviewClient`, `requestRevisiInternal`, `requestRevisiClient`, `backToProgressFromRevisi`, and `clientMarkSelesai`. All authorization, phase locks, ownership checks, unit hold/release/finalization behaviors, and return codes must match the user-provided spec exactly.",
      "reqIds": [
        "REQ-69"
      ],
      "status": "pending"
    },
    {
      "id": "AR-66",
      "summary": "In `requestRevisiInternal` and `requestRevisiClient`, if functions named `setRevisiInternal` and/or `setRevisiClient` already exist in `backend/main.mo`, invoke them as specified; do not create migration code or alter existing revision functions. If the revision functions do not exist, do not add placeholder implementations; proceed without calling them.",
      "reqIds": [
        "REQ-70"
      ],
      "status": "pending"
    },
    {
      "id": "AR-67",
      "summary": "Implement TASK FLOW V1 query methods in the appended block: `public query ({ caller }) func listMyTasks() : async [Task]` and `public query func getTask(taskId: Text) : async ?Task` with the exact role-based listing rules provided (client: their tasks; partner: assigned tasks; asistenmu: all tasks preferred; others: empty).",
      "reqIds": [
        "REQ-71"
      ],
      "status": "pending"
    },
    {
      "id": "AR-68",
      "summary": "Ensure the code compiles after appending TASK FLOW V1, and ensure no existing `LayananAsistenku` or `LayananMeta V2` types/maps/methods are modified (read-only usage only).",
      "reqIds": [
        "REQ-72"
      ],
      "status": "pending"
    },
    {
      "id": "AR-69",
      "summary": "Append-only backend/main.mo: add “LAYANAN PAKET + SHARING RULE” block with PaketLayanan and LayananPaketMeta, new Map storages (layananPaketById, layananIdsByPrincipal), share limit rules (2/2/3/4), helper funcs (nowIntV3/ shareLimitV3/ arrayContainsPrincipalV3/ upsertIndexV3/ canAccessLayananV3), admin-or-superadmin gating (reuse requireAdminOrSuperadminImpl if present else add requireAdminOrSuperadminV3), and public methods createLayananPaketForClientV3/setLayananPaketActiveV3/shareLayananPaketV3 plus authenticated queries listMyLayananPaketIdsV3/getLayananPaketMetaV3; base layananId must already exist in existing layanan stores.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-70",
      "summary": "Append a new “LAYANAN PAKET + SHARING RULE” block at the very bottom of backend/main.mo (append-only) that introduces the new paket enum type and paket-meta record type using the exact identifiers and variants: `public type PaketLayanan = { #tenang; #rapi; #fokus; #jaga };` and `public type LayananPaketMeta = { layananId : Text; ownerClient : Principal; paket : PaketLayanan; harga : Nat; isActive : Bool; sharedWith : [Principal]; createdAt : Int; updatedAt : Int; };` with `sharedWith` required to include `ownerClient`.",
      "reqIds": [
        "REQ-73"
      ],
      "status": "pending"
    },
    {
      "id": "AR-71",
      "summary": "Append new in-canister storage maps (new names only) for layanan paket meta and access indexing exactly as specified: `let layananPaketById = Map.empty<Text, LayananPaketMeta>()` and `let layananIdsByPrincipal = Map.empty<Principal, [Text]>()` (index includes owner + shared principals).",
      "reqIds": [
        "REQ-74"
      ],
      "status": "pending"
    },
    {
      "id": "AR-72",
      "summary": "Append helper functions (new names only) implementing sharing limit and access utilities: `shareLimitV3(p : PaketLayanan) : Nat` returning 2 for #tenang/#rapi, 3 for #fokus, 4 for #jaga; `arrayContainsPrincipalV3(arr:[Principal], p:Principal) : Bool`; `upsertIndexV3(principal:Principal, layananId:Text) : ()` adding the layananId to `layananIdsByPrincipal[principal]` if missing; and `canAccessLayananV3(principal:Principal, meta:LayananPaketMeta) : Bool` returning true when `principal` is in `meta.sharedWith`. Also add `nowIntV3() : Int` only if an existing `now()` helper is not already available; otherwise call the existing `now()` and return its value.",
      "reqIds": [
        "REQ-75"
      ],
      "status": "pending"
    },
    {
      "id": "AR-73",
      "summary": "Enforce that only admin or superadmin can create, share, or toggle layanan paket. Reuse an existing permission helper if present: call `requireAdminOrSuperadminImpl(caller)` if it exists; otherwise, append a new helper `requireAdminOrSuperadminV3(caller:Principal)` that reuses the existing role-check patterns in backend/main.mo without modifying those existing functions.",
      "reqIds": [
        "REQ-76"
      ],
      "status": "pending"
    },
    {
      "id": "AR-74",
      "summary": "Append new public methods (new names only) implementing layanan paket lifecycle and sharing, with the exact signatures and return strings: (1) `public shared ({ caller }) func createLayananPaketForClientV3(ownerClient : Principal, paket : PaketLayanan, harga : Nat, layananId : Text) : async Text` gated by admin/superadmin; validate `layananId` already exists in an existing base layanan store (e.g., existing `layananById` or existing layanan meta store) and do not create a base layanan; if base layanan does not exist, return a non-OK string per the user’s rules (do not create data). On success, create `LayananPaketMeta` with `sharedWith=[ownerClient]`, `isActive=true`, timestamps from now, save it in `layananPaketById`, upsert index for `ownerClient`, return exactly `\"OK\"`. (2) `public shared ({ caller }) func setLayananPaketActiveV3(layananId:Text, isActive:Bool) : async Text` gated by admin/superadmin; if missing meta return `\"NOT_FOUND\"`, else update `isActive` + `updatedAt`, return `\"OK\"`. (3) `public shared ({ caller }) func shareLayananPaketV3(layananId:Text, target:Principal) : async Text` gated by admin/superadmin; if missing meta return `\"NOT_FOUND\"`; if duplicate share do not add; enforce share limit based on paket where limit counts total principals in `sharedWith` (including owner); if limit reached return `\"SHARE_LIMIT_REACHED\"`; otherwise add target, update `updatedAt`, save back, upsert index for target, return `\"OK\"`.",
      "reqIds": [
        "REQ-77"
      ],
      "status": "pending"
    },
    {
      "id": "AR-75",
      "summary": "Append authenticated query methods for access listing and meta retrieval: (1) `public query ({ caller }) func listMyLayananPaketIdsV3() : async [Text]` must require the caller to be authenticated using the existing authentication check pattern already used in backend/main.mo; return `layananIdsByPrincipal.get(caller)` or `[]` if none. (2) `public query ({ caller }) func getLayananPaketMetaV3(layananId:Text) : async ?LayananPaketMeta` must require authentication using the existing pattern; return null if not found; if caller is admin/superadmin return meta; otherwise return meta only when caller is in `meta.sharedWith`, else return null.",
      "reqIds": [
        "REQ-78"
      ],
      "status": "pending"
    },
    {
      "id": "AR-76",
      "summary": "Append-only backend/main.mo: add a public query `canCreateTaskUI() : async Bool` (no new imports/types/maps/helpers/comments) that enables the frontend “Buat Task” button only when caller is registered, role is client, userStatus is #active, and caller has at least one active layanan meta via existing `layananIdsByOwnerClient` + `layananMetaById` (current requested implementation checks `meta.isActive` for any owned layanan).",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-77",
      "summary": "Update ONLY `backend/main.mo` by appending the following Motoko function immediately before the final closing brace of the main `actor { ... }` (append-only; do not modify, delete, reorder, or reformat any existing code). Append the function exactly as written (including whitespace and semicolons):\n\npublic query ({ caller }) func canCreateTaskUI() : async Bool {\n    requireRegistered(caller);\n\n    if (not isClientRole(caller)) {\n        return false;\n    };\n\n    let status = getUserStatusInternal(caller);\n    switch (status) {\n        case (#active) {};\n        case (_) { return false };\n    };\n\n    switch (layananIdsByOwnerClient.get(caller)) {\n        case (null) { return false };\n        case (?ids) {\n            for (id in ids.vals()) {\n                switch (layananMetaById.get(id)) {\n                    case (?meta) {\n                        if (meta.isActive) { return true };\n                    };\n                    case (_) {};\n                };\n            };\n            return false;\n        };\n    };\n}",
      "reqIds": [
        "REQ-79"
      ],
      "status": "pending"
    },
    {
      "id": "AR-78",
      "summary": "Append-only change inside existing createTask: insert the provided hard validation block at the very top of the function body to enforce caller is registered client, status is #active, and caller has at least one active layanan meta; return \"NOT_ALLOWED\" when failing any check; STOP if any referenced identifier is missing.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-79",
      "summary": "Append-only: add shared method transitionTaskPhase(taskId:Text,newPhase:TaskPhase): async Text before actor closing brace, with role/ownership-based allowed transitions (client/am/partner cases), NOT_FOUND/NOT_ALLOWED/OK return strings, update task.phase and updatedAt = nowSync(), and write back to taskById; STOP if any referenced identifier is missing.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-80",
      "summary": "Update ONLY `backend/main.mo` by appending the provided Motoko method `transitionTaskPhase(taskId : Text, newPhase : TaskPhase) : async Text` immediately before the actor’s final closing brace `}`. The appended code must be byte-for-byte identical to the user-provided block (no refactors, no formatting changes, no renamed identifiers).",
      "reqIds": [
        "REQ-80"
      ],
      "status": "pending"
    },
    {
      "id": "AR-81",
      "summary": "Before applying the append, verify that every identifier referenced by the provided `transitionTaskPhase` block already exists in `backend/main.mo` (e.g., `requireRegistered`, `taskById`, `Task`, `TaskPhase`, `isClientRole`, `isAsistenmuRole`, `isPartnerRole`, `nowSync`). If any referenced identifier is missing, do not modify any file and stop the change.",
      "reqIds": [
        "REQ-81"
      ],
      "status": "pending"
    },
    {
      "id": "AR-82",
      "summary": "Make `superadminClaimed` persist across upgrades by changing its declaration from `var` to `stable var` in backend/main.mo, with no other code changes and no migration files.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-83",
      "summary": "In `backend/main.mo`, modify ONLY the declaration of `superadminClaimed` by replacing the exact line `var superadminClaimed = false;` with `stable var superadminClaimed = false;`. Do not change any other line, do not add any new files (including `migration.mo`), and do not modify any functions (including `claimSuperadmin`).",
      "reqIds": [
        "REQ-82"
      ],
      "status": "pending"
    },
    {
      "id": "AR-84",
      "summary": "Implement \"Model A\" Internal Login flow in frontend/src/pages/InternalLogin.tsx ONLY: allow backend calls (getCallerUser, isSuperadminClaimed, claimSuperadmin), II login gating, role card selection, single getCallerUser check on 'Ruang kerja', mismatch/registration/status warnings without auto-redirect, superadmin claim button/redirect logic, and redirect to fixed dashboard routes; do not modify any other frontend file or backend/main.mo.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-85",
      "summary": "Patch `frontend/src/pages/internal/InternalLogin.tsx` so the “Claim Superadmin” action calls the correct backend method `claimSuperadmin()` (not `saveCallerUserProfile()`/role assignment), resolving the unauthorized error and enabling superadmin claim.",
      "reqIds": [],
      "status": "pending"
    },
    {
      "id": "AR-86",
      "summary": "Update InternalLogin.tsx to (1) guard Claim Superadmin click when actor is not ready (show inline warning instead of calling backend), (2) display a separate \"Claim Superadmin\" card that does not require selecting the superadmin role first, and (3) automatically hide/remove that claim card once superadmin has been successfully claimed (or when isSuperadminClaimed indicates already claimed).",
      "reqIds": [],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Static Asistenku UI pages + routing (frontend-only, no backend/auth/data)",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}